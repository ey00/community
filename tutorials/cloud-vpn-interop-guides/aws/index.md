---
title: Using Cloud VPN with Amazon Web ServicesTM Virtual Private Gateway
description: Learn how to build a site-to-site IPsec VPN tunnel between Google
Cloud Platform and Amazon Web Services.
author: elliot
tags: Cloud VPN, Amazon Web Services
date_published: 2017-12-25
---
<!---
Note: Amazon Web Services, AWS, and the "Powered by Amazon Web Services" logo are
trademarks of Amazon.com, Inc. or its affiliates in the United States andor
other countries.
--->

If you own VPC networks in Google Cloud Platform (GCP) and Amazon Web
Services (AWS), you can use an IPsec VPN tunnel to connect them. Through the
tunnel, VM instances in one network can send and receive traffic to and from
instances in the other network by using internal (private) IP addresses.

The following tutorial uses Google Cloud VPN and an AWS Virtual Private Gateway
(VPG) to establish an IPsec VPN tunnel. You can choose to configure the tunnel
with dynamic or static routing. In the tutorial, replace the samples values with
values from your environment such as IP addresses, device IDs, shared secrets,
and project names.

For dynamic routing, you use the Border Gateway Protocol (BGP) to dynamically
exchange routes between networks. For static routing, you have static routes on
both sides of the network to define which traffic is allowed on the tunnel.

## Objectives
Whether you choose the dynamic or static routing configuration, you'll complete
the following steps:

* Create a new AWS VPC network
* Configure the Amazon Virtual Private Gateway
* Configure the Amazon Customer Gateway
* Configure the Google Cloud VPN gateway and tunnel
* Set up the VPN Connection
* Connect to GCP
* Test the tunnel
* Clean up all resources

## Before you begin
Familiarize yourself with AWS Virtual Private Cloud (VPC) and GCP VPC
networks. This tutorial isn't intended to be a comprehensive guide to AWS and
GCP. Rather, it's intended to help you establish IPsec VPN connectivity between
AWS to GCP VPC networks.

For this tutorial, familiarize yourself with the following AWS objects:
*  **Virtual Private Cloud** – your private network in AWS.
*  **Virtual Private Gateway** – the VPN concentrator on the Amazon side of the
   VPN connection.
*  **Customer Gateway** – AWS reference to the Google Cloud VPN gateway.

For more information about each platform, view the [Amazon VPC User
Guide](http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html/)
and the [GCP VPC documentation](http://cloud.google.com/vpc/docs).

## Costs
This tutorial uses billable components from both platforms:

* AWS pricing info
* GCP pricing info

## Summary of the IPsec configuration
For this tutorial, you'll use the following IPsec configuration to establish a
VPN tunnel between your AWS and GCP VPC networks. For the AWS IPsec
configuration, the tutorial uses the following values:

|Parameter | Value |
|--------- |  ----- |
|IPsec Mode | ESP+Auth Tunnel mode (Site-to-Site) |
|Auth protocol | PSK |
|Key Exchange | IKEv1 |
|Start | Auto |
|PFS | On |
|DPD | Aggressive |
|INITIAL_CONTACT | ON |

For the tunnel authentication, you'll use the **pre-shared key** that's
generated by AWS.

For the IPsec tunnel, the tutorial uses the following configuration:

|Phase | Cipher Role | Cipher|
------|-------------|-------
|Phase1 | Encryption | AES-256 |
|       | Integrity | SHA-1 |
|       | PRF       | SHA1-96 |
|       | Diffie-Helman | Group14 |
|       | Phase1 lifetime | 36000 |
|Phase2 | Encryption | AES-CB-256 |
|       | Integrity | SHA-512 |
|       | Phase1 lifetime | 108000 |

## Dynamic routing
In general, dynamic routing gives you greater flexibility compared to static
routing. As your network topology changes, both networks learn and propagate
those changes. The following sections walk you through creating an IPsec VPN
connection with dynamic routing.

For more information about static routing, see the [Static routing]() section.

### GCP VPC network
In GCP, all projects start with a single *default* VPC network. The default
network includes a subnet in each GCP region, each with a predefined internal IP
range. The default network also includes a set of default firewall rules that
allow inter-subnet communication and access to certain services from the
Internet. For this tutorial, you'll use the default network for creating the
site-to-site VPN. You don't need to create a new one. For information about the
default network, see [Virtual Private Cloud Network
Overview](https://cloud.google.com/vpc/docs/vpc) in the GCP documentation.

For more information about creating and managing projects, see [Creating and
Managing
Projects](https://cloud.google.com/resource-manager/docs/creating-managing-projects).

#### Reserving an static external IP address in GCP
When you configure your AWS VPC, you'll need specify the external (public) IP
address of your Cloud VPN gateway. You can reserve an IP address first, and then
assign it to your Cloud VPN gateway later. That way, when you configure your AWS
VPC, you'll know which IP address to use. If you already have an unused reserved
IP address, you can use that instead.

To reserve a static external IP address, see [Reserving a Static External IP
address]( https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address)
in the GCP documentation.

### Creating the AWS VPC and VPG
Before you connect your AWS and GCP VPC networks, create a VPC network in AWS
with a VPG and customer gateway.

1. Go to the [VPC dashboard](www.console.aws.amazon.com/vpc/home) in the AWS
   Management Console.
1. Select an AWS region. For this tutorial, select the **US East (N. Virginia)
   region**. Later, you'll connect the VPN tunnel to a GCP region close in
   proximity to this AWS region. For more information about selecting a region,
   see [Working with the AWS Management
   Console](http://docs.aws.amazon.com/awsconsolehelpdocs/latest/gsg/getting-started.html#select-region)
   in the AWS Management Console Getting Started Guide.
1. Select **Start VPC Wizard**. For this tutorial, create a new VPC to connect
   to the Google Cloud Platform instead of using the default VPC. The VPC
   Wizard walks you through the creation and configuration of a new VPC,
   customer gateway, and VPG.
1. Select **VPC with a Private Subnet Only and Hardware VPN Access**. You can
   choose options for various combinations of private and public IP addressing,
   with or without VPN connectivity. For this tutorial, you need a private
   subnet with VPN access.
1. Configure the following VPC settings, and then select **Next**:

    * **IPv4 CIDR Block** &mdash; The IPv4 CIDR block for the VPC. You can't
      change it after it's set. For this tutorial, use `10.0.0.0/16`
    * **IPv6 CIDR Block** &mdash; Select whether to include an IPv6 CIDR block
      for the VPC. For this tutorial select **No IPv6 CIDR Block**.
    * **VPC Name** &mdash; The name of the VPC. Enter `GCP-test`.
    * **Private subnet's IPv4 CIDR** &mdash; The private subnet's CIDR block
      within the AWS VPC CIDR block. Enter `10.0.1.0/24`. You'll connect to this
      subnet from the GCP VPC network.
    * **Availability Zone** &mdash; The AWS Availability Zone into which the VPC
      will be deployed. Keep the default value of **no preference**.
    * **Private Subnet Name** &mdash; A friendly name for the private subnet.
      Enter `AWS-VPC`.
    * **Service endpoint** &mdash; An option that enables you to connect to AWS
      services without using public IP addresses. This tutorial doesn't require
      a service endpoint. You can ignore this option.
    * **Enable DNS Hostnames** &mdash; Enables automatic DNS hostname assignment
      through DHCP for the private subnet. Enable DNS hostnames.
    * **Hardware Tenancy** &mdash; Select whether instances in the VPC run on
      isolated hardware. Use **Default** for this tutorial.
1. Configure the following VPN settings, and then select **Create VPC**.

    * **Customer Gateway IP** &mdash; The static external IP address of the
      Cloud VPN gateway. Use the IP address that you reserved or an unused
      external static IP address.
    * **Customer Gateway name** &mdash; A name to indicate which gateway this
      one is peering with. Enter `GCP-gateway`.
    * **VPN Connection name** &mdash; A name for this VPN connection. Enter
      `AWS-to-GCP`.
    * **Routing Type** &mdash; Select **Dynamic** for the routing type.

VPC creation takes a minute or two to complete. After it's done, the
management console status is updated, showing your new VPC.

### Downloading AWS VPN configuration
To configure Cloud VPN and the VPN tunnel on the GCP side, you need the
AWS VPG configuration information.

1. Go to the [list of VPN
   connections](https://console.aws.amazon.com/vpc/home#VpnConnections:sort=VpnConnectionId)
   in the AWS Management Console.
1. Select the **AWS-to-GCP** connection, and then select **Download
   Configuration** to get an ASCII text file that contains information about
   your AWS VPG configuration.
1. For the format of the configuration file, select the following values:

    * **Vendor** &mdash; Select **Generic**.
    * **Platform** &mdash; Select **Generic**.
    * **Software** &mdash; Select **Vendor Agnostic**.
1. View the configuration file and collect the relevant information, such as the
   pre-shared key and IP addresses. You'll need these values when you configure
   the GCP side of the VPN tunnel. The following example shows a sample AWS VPN
   configuration file:

![sample-aws-vpn-config-file](https://storage.googleapis.com/gcp-community/tutorials/cloud-vpn-interop-guides/aws/sample-aws-vpn-config-file.png)

Note: For redundancy, AWS creates two VPN tunnels for each VPN connection. As a
result, the configuration file includes two sets of IPsec VPN tunnel
configurations. On the GCP side, create a VPN tunnel for each AWS tunnel
configuration. Don't mix configurations. If you do, the VPN connections will
fail.

### Creating a Cloud VPN gateway and VPN tunnel
For the GCP side of the VPN tunnel, use Google Cloud VPN to create a VPN gateway
that peers with the AWS VPG. You'll also create two tunnels on the gateway with
dynamic routing. For dynamic routing, you'll create a Cloud Router to establish
BGP sessions with your AWS VPC network.

1. Go to the create VPN page in the [Google Cloud
   Console](https://console.cloud.google.com/networking/vpn/add).
1. Configure the VPN gateway:
    * **Name** &mdash; A name for the VPN gateway. Enter `gcp-to-aws`.
    * **VPC network** &mdash; The VPC network containing that you want to
      connect to your AWS VPC. Select **default**.
    * **Region**  &mdash; The region where you want to create the VPN gateway.
      The GCP side of the VPN tunnel terminates in this region. For this
      tutorial, select `us-east4` because it's close in proximity to your AWS
      VPG, which should be in US East (N. Virginia).
    * **IP Address** &mdash; Select the [static external IP
      address](/compute/docs/ip-addresses#reservedaddress) that you created
      earlier. The IP address must match the value that your specified for the
      AWS customer gateway IP.
1. Configure the VPN tunnels:
    * **Remote peer IP address** &mdash; The *Virtual Private Gateway outside IP
      address* that AWS assigned in the AWS VPN configuration file.
    * **IKE version** &mdash; Select **IKEv1**. AWS supports only IKEv1.
    * **Shared Secret** &mdash; Enter the pre-shared key that AWS generated.
      This value is in the AWS VPN configuration file.
    * **Routing options** &mdash; Select **Dynamic (BGP)**.
    * **Cloud router** &mdash; Select **Create cloud router**, then configure
      it. After you're done, select **Save and continue**.
        * **Name** &mdash; The name of the Cloud Router. Enter
          `gcp-to-aws-router`.
        * **Google ASN** &mdash; The [private
          ASN](https://tools.ietf.org/html/rfc6996) (64512 - 65534, 4200000000
          - 4294967294) of the Cloud Router. Use the ASN that AWS assigned in
          the VPN configuration file (the *Customer Gateway ASN* value).
    * **BGP session** &mdash; Configure a BGP session by clicking edit icon and
      populating the following fields. After you're done, select **Save and
      continue**.
        * **Name** &mdash; A name for this BGP session. Enter `gcp-to-aws-bgp`.
        * **Peer ASN** &mdash; The [private
          ASN](https://tools.ietf.org/html/rfc6996){: class="external" } (64512
          - 65534, 4200000000 - 4294967294) of the AWS VPG. Use the ASN that AWS
            assigned in the VPN configuration file (the *Virtual Private
            Gateway ASN* value).
        * **Advertised route priority (MED)** &mdash; If you have multiple paths
          between your GCP and AWS network, you can use the route priority to
          set the preferred routes. For this tutorial, skip this field.
        * **Cloud Router BGP IP** &mdash; The *Customer Gateway inside IP
          address* that AWS assigned in the AWS VPN configuration file, such as
          `169.254.12.186`.
        * **BGP peer IP** &mdash; The *Virtual Private Gateway inside IP
          address* that AWS assigned in the AWS VPN configuration file, such as
          `169.254.12.185`.
1. Select **Add tunnel** and then repeat the VPN tunnel and BGP configuration
   steps to create the redundant VPN tunnel. Add the second BGP session to the
   Cloud Router that you previously created. Don't create another Cloud Router.
1. Select **Create** to create the gateway, Cloud Router, and all tunnels. GCP
   creates the necessary forwarding rules for the gateway and tunnels.

Next, create firewall rules to allow inbound traffic from the AWS VPC subnets.

## Static routing
With static routing, you must maintain routes on both networks as they change.
Also, changes to static routes require you to restart the VPN tunnel. The AWS
service is a route-based solution, so the following sections walk you through a
route-based solution instead of a policy-based solution.

### GCP VPC network
In GCP, all projects start with a single *default* VPC network. The default
network includes a subnet in each GCP region, each with a predefined internal IP
range. The default network also includes a set of default firewall rules that
allow inter-subnet communication and access to certain services from the
Internet. For this tutorial, you'll use the default network for creating the
site-to-site VPN. You don't need to create a new one. For information about the
default network, see [Virtual Private Cloud Network
Overview](https://cloud.google.com/vpc/docs/vpc) in the GCP documentation.

#### Reserving an static external IP address in GCP
When you configure your AWS VPC, you'll need specify the external (public) IP
address of your Cloud VPN gateway. You can reserve an IP address first, and then
assign it to your Cloud VPN gateway later. That way, when you configure your AWS
VPC, you'll know which IP address to use. If you already have an unused reserved
IP address, you can use that instead.

To reserve a static external IP address, see [Reserving a Static External IP
address]( https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address)
in the GCP documentation.

### Creating the AWS VPC and VPG
Before you connect your AWS and GCP VPC networks, create a VPC network in AWS
with a VPG and customer gateway.

1. Go to the [VPC dashboard](www.console.aws.amazon.com/vpc/home) in the AWS
   Management Console.
1. Select an AWS region. For this tutorial, select the **US East (N. Virginia)
   region**. Later, you'll connect the VPN tunnel to a GCP region close in
   proximity to this AWS region. For more information about selecting a region,
   see [Working with the AWS Management
   Console](http://docs.aws.amazon.com/awsconsolehelpdocs/latest/gsg/getting-started.html#select-region)
   in the AWS Management Console Getting Started Guide.
1. Select **Start VPC Wizard**. For this tutorial, create a new VPC to connect
   to the Google Cloud Platform instead of using the default VPC. The VPC
   Wizard walks you through the creation and configuration of a new VPC,
   customer gateway, and VGP.
1. Select **VPC with a Private Subnet Only and Hardware VPN Access**. You can
   choose options for various combinations of private and public IP addressing,
   with or without VPN connectivity. For this tutorial, you need a private
   subnet with VPN access.
1. Configure the following VPC settings, and then select **Next**:

    * **IPv4 CIDR Block** &mdash; The IPv4 CIDR block for the VPC. You can't
      change it after it's set. For this tutorial, use `10.0.0.0/16`
    * **IPv6 CIDR Block** &mdash; Select whether to include an IPv6 CIDR block
      for the VPC. For this tutorial select **No IPv6 CIDR Block**.
    * **VPC Name** &mdash; The name of the VPC. Enter `GCP-test`.
    * **Private subnet's IPv4 CIDR** &mdash; The private subnet's CIDR block
      within the AWS VPC CIDR block. Enter `10.0.1.0/24`. You'll connect to this
      subnet from the GCP VPC network.
    * **Availability Zone** &mdash; The AWS Availability Zone into which the VPC
      will be deployed. Keep the default value of **no preference**.
    * **Private Subnet Name** &mdash; A friendly name for the private subnet.
      Enter `AWS-VPC`.
    * **Service endpoint** &mdash; An option that enables you to connect to AWS
      services without using public IP addresses. This tutorial doesn't require
      a service endpoint. You can ignore this option.
    * **Enable DNS Hostnames** &mdash; Enables automatic DNS hostname assignment
      through DHCP for the private subnet. Enable DNS hostnames.
    * **Hardware Tenancy** &mdash; Select whether instances in the VPC run on
      isolated hardware. Use **Default** for this tutorial.
1. Configure the following VPN settings, and then select **Create VPC**.

    * **Customer Gateway IP** &mdash; The static external IP address of the
      Cloud VPN gateway. Use the IP address that you reserved or an unused
      external static IP address.
    * **Customer Gateway name** &mdash; A name to indicate which gateway this
      one is peering with. Enter `GCP-gateway`.
    * **VPN Connection name** &mdash; A name for this VPN connection. Enter
      `AWS-to-GCP`.
    * **Routing Type** &mdash; Select **Static** for the routing type.
        * **IP Prefix** &mdash; Enter `10.150.0.0/20`, which is the default
          network's subnet IP range in the us-east4 region.

VPC creation takes a minute or two to complete. After it's done, the
management console status is updated, showing your new VPC.

### Downloading AWS VPN configuration
To configure Cloud VPN and the VPN tunnel on the GCP side, you need the
AWS VPG configuration information.

1. Go to the [list of VPN
   connections](https://console.aws.amazon.com/vpc/home#VpnConnections:sort=VpnConnectionId)
   in the AWS Management Console.
1. Select the **AWS-to-GCP** connection, and then select **Download
   Configuration** to get an ASCII text file that contains information about
   your AWS VPG configuration.
1. For the format of the configuration file, select the following values:

    * **Vendor** &mdash; Select **Generic**.
    * **Platform** &mdash; Select **Generic**.
    * **Software** &mdash; Select **Vendor Agnostic**.
1. View the configuration file and collect the relevant information, such as the
   pre-shared key and gateway IP addresses. You'll need these values when you
   configure the GCP side of the VPN tunnel. The following example shows a
   sample AWS VPN configuration file:

![sample-aws-vpn-config-file](https://storage.googleapis.com/gcp-community/tutorials/cloud-vpn-interop-guides/aws/sample-aws-vpn-config-file.png)

Note: For redundancy, AWS creates two VPN tunnels for each VPN connection. As a
result, the configuration file includes two sets of IPsec VPN tunnel
configurations. On the GCP side, create a VPN tunnel for each AWS tunnel
configuration. Don't mix configurations. If you do, the VPN connections will
fail.

### Creating a Cloud VPN gateway and VPN tunnel
For the GCP side of the VPN tunnel, use Google Cloud VPN to create a VPN gateway
that peers with the AWS VPG. You'll also create two VPN tunnels on a single VPN
gateway and specify the destination IP ranges that the tunnels allow.

1. Go to the create VPN page in the [Google Cloud
   Console](https://console.cloud.google.com/networking/vpn/add).
1. Configure the VPN gateway:
    * **Name** &mdash; A name for the VPN gateway. Enter `gcp-to-aws`.
    * **VPC network** &mdash; The VPC network containing that you want to
      connect to your AWS VPC. Select **default**.
    * **Region**  &mdash; The region where you want to create the VPN gateway.
      The GCP side of the VPN tunnel terminates in this region. For this
      tutorial, select `us-east4` because it's close in proximity to your AWS
      VPG, which should be in US East (N. Virginia).
    * **IP Address** &mdash; Select the [static external IP
      address](/compute/docs/ip-addresses#reservedaddress) that you created
      earlier. The IP address must match the value that your specified for the
      AWS customer gateway IP.
1. Configure the VPN tunnels:
    * **Remote peer IP address** &mdash; The *Virtual Private Gateway outside IP
      address* that AWS assigned in the AWS VPN configuration file.
    * **IKE version** &mdash; Select **IKEv1**. AWS only supports IKEv1.
    * **Shared Secret** &mdash; Enter the pre-shared key that AWS generated.
      This value is in the AWS VPN configuration file.
    * **Routing options** &mdash; Select **Static**.
    * **Remote network IP ranges** &mdash; The AWS private subnet `10.0.1.0/24`.
    * **Local IP ranges** &mdash; The GCP subnet `10.150.0.0/20`.
1. Select **Add tunnel** and then repeat the previous steps to add the redundant
   VPN tunnel.
1. Select **Create** to create the gateway and all tunnels. GCP creates the
   necessary forwarding rules for the gateway and tunnels.

Next, create firewall rules to allow inbound traffic from the AWS VPC subnets.

### Creating routes (done automatically for static routing?)
For AWS, do this

For GCP, do this

## Creating firewall rules
Create firewall rules to allow inbound traffic from each of the networks.

In AWS, security groups act as a virtual firewall. You modify security groups to
specify the inbound and outbound traffic that your VPC network allows. To allow
inbound traffic from GCP, modify the default security group for the `GCP-test`
VPC.

1. Go to the [list of security
   groups](https://console.aws.amazon.com/vpc/home#securitGroups:)
   in the AWS Management Console.
1. Select the security group that's associated with the `GCP-test` VPC. The
   **VPC** column shows which VPC is associated with a security group.
1. In the details pane, select the **Inbound Rules** tab, and then click
   **Edit**.
1. Select **Add another rule**.
1. For the Type, select **Custom ICMP Rule**. Use the default values `ICMP` and
   `Echo Reply` for the protocol and port range. For this tutorial, you only
   need to allow traffic for a ping test.
1. For the **Source**, specify the GCP subnet `10.150.0.0/20`, and then select
   **Save**.

In GCP, you work with firewall rules to determine which connections are allowed.
To allow inbound traffic from AWS, create a firewall rule for the `default` VPC
network.

1. Go to the Firewall rules page in the [Google Cloud
   Console](https://console.cloud.google.com/networking/firewalls/list)
1. Select **Create firewall rule**.
1. Enter `aws-vpn-rule` for name of the firewall rule.
1. For the **Network** field, select **default** so that the firewall rule applies to
   the default network.
1. For the **Priority** field, leave the default value. When you have multiple
   conflicting rules, use the priority to specify the order of evaluation. The
   lower the priority, the earlier the rule is evaluated.
1. For the **Direction of traffic** field, select **Ingress** to apply this rule
   to inbound traffic.
1. For the **Action on match** field, select **Allow** to allow inbound traffic
   that matches this rule.
1. For the **Targets** of the rule, select **All instances in the network** so
   that this rule applies to all instances in the network
1. For the **Source filter** field, select `IP ranges` so that this rule applies
   to packets from a specific IP range (inbound traffic).
1. For the **Source IP ranges** field, specify the AWS subnet `10.0.1.0/24` to
   allow traffic from that IP range.
1. For the **Protocols and ports** field, select **Specified protocols and
   ports**, and then enter `icmp`.
1. Select **Create** to create the firewall rule.

For both VPC networks, you have firewalls rules to allow traffic between each
subnet.

``` Amazon Web Services Virtual Private Cloud

VPN Connection Configuration
================================================================================
AWS utilizes unique identifiers to manipulate the configuration of a VPN
Connection. Each VPN Connection is assigned a VPN Connection Identifier and is
associated with two other identifiers, namely the Customer Gateway Identifier
and the Virtual Private Gateway Identifier.

Your VPN Connection ID                   : vpn-67cbd375 Your Virtual Private
Gateway ID          : vgw-8ed30890 Your Customer Gateway ID                 :
cgw-a919c2b7

A VPN Connection consists of a pair of IPSec tunnel security associations (SAs).
It is important that both tunnel security associations be configured.

IPSec Tunnel #1
================================================================================
#1: Internet Key Exchange Configuration

Configure the IKE SA as follows: Please note, these sample configurations are
for the minimum requirement of AES128, SHA1, and DH Group 2.  You will need to
modify these sample configuration files to take advantage of AES256, SHA256, or
other DH groups like 2, 14-18, 22, 23, and 24.  The address of the external
interface for your customer gateway must be a static address.  Your customer
gateway may reside behind a device performing network address translation (NAT).
To ensure that NAT traversal (NAT-T) can function, you must adjust your firewall
!rules to unblock UDP port 4500. If not behind NAT, we recommend disabling
NAT-T.
  - Authentication Method    : Pre-Shared Key
  - Pre-Shared Key           : aws-generated-key
  - Authentication Algorithm : sha1
  - Encryption Algorithm     : aes-128-cbc
  - Lifetime                 : 28800 seconds
  - Phase 1 Negotiation Mode : main
  - Perfect Forward Secrecy  : Diffie-Hellman Group 2

#2: IPSec Configuration

Configure the IPSec SA as follows: Please note, you may use these additionally
supported IPSec parameters for encryption like AES256 and other DH groups like
2, 5, 14-18, 22, 23, and 24.
  - Protocol                 : esp
  - Authentication Algorithm : hmac-sha1-96
  - Encryption Algorithm     : aes-128-cbc
  - Lifetime                 : 3600 seconds
  - Mode                     : tunnel
  - Perfect Forward Secrecy  : Diffie-Hellman Group 2

IPSec Dead Peer Detection (DPD) will be enabled on the AWS Endpoint. We
recommend configuring DPD on your endpoint as follows:
  - DPD Interval             : 10
  - DPD Retries              : 3

```

## Check connectivity
Use the Google Cloud Console to check whether your IPsec VPN tunnel has been
successfully established.

1. Go to the list of Cloud VPNs in the [Google Cloud
   Console](https://console.cloud.google.com/networking/vpn/list).
1. Find the name of your Cloud VPN gateway `gcp-to-aws`.
1. In the **Remote peer IP address** column, view the status of your AWS VPG
   external IP address. If the tunnel is established, the console displays the
   success status (green circle with a checkmark). If the console displays an
   error status (red circle with an exclamation mark), the tunnel is still being
   established or has failed to established. For details about the error status,
   select **View** in the **Logs** column.

   For more information about the Cloud VPN logs, see [Viewing VPN
   Logs](https://cloud.google.com/vpn/docs/how-to/logging) in the Cloud VPN
   documentation.

For dynamic routing, check that Cloud Router successfully established a BGP
session with AWS.

1. Go to the list of Cloud Routers in the [Google Cloud
   Console](https://console.cloud.google.com/networking/vpn/list)
1. Find the name of your Cloud Router `gcp-to-aws-router`.
1. In the **BGP sessions** column, view the status of the BGP session
   `gcp-to-aws-bgp`. If the session is established, the console displays the
   success status. If the console displays an error status, the session is still
   being established or has failed to established. For details about the error
   status, select **View** in the **Logs** column.

   For more information about Cloud Router logs, see [Viewing
   Logs](https://console.cloud.google.com/router/docs/how-to/viewing-logs) in
   the Cloud Router documentation.

## Testing the IPsec VPN tunnel
To test the tunnel, you need two VM instances, one in each VPC network. After
the VM instances are deployed, log in to one of the instances. Then, use an ICMP
echo request to ping the other instance by using its internal IP address. If the
request is successful, the tunnel is ready. If not, check your firewall rules,
routes, or any logging information to troubleshoot the issue.

To launch a VM instance in AWS, see [Getting Started with Amazon EC2 Linux
Instances](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html)
in the Amazon Elastic Compute Cloud User Guide for Linux Instances. Configure
the instance details so that it's launched in the `GCP-test` VPC and `AWS-VPC`
subnet.

To create an instance in GCP, see [Quickstart Using a Linux
VM](https://cloud.google.com/compute/docs/quickstart-linux) in the Compute
Engine documentation. Create the networking in any of the us-east4 zones.

## What's next
For more information about Cloud VPN and GCP VPC networks, such as the CLI
commands, view the following documentation:

* [GCP Cloud VPN](https://cloud.google.com/vpn/docs/)
* [GCP VPC Networks](https://cloud.google.com/vpc/docs/)
* [Troubleshooting Cloud VPN](https://cloud.google.com/vpn/docs/resources/troubleshooting)
